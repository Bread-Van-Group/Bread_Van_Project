{% extends "owner/layout.html" %}

{% block title %}Set Inventory{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/owner/homepage.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/owner/set_inventory.css') }}">
  {{ super() }}
{% endblock %}

{% block content %}
<div class="page-wrapper">
  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <div class="sidebar-logo">LOGO</div>
    <a class="sidebar-btn" href="{{ url_for('index_views.owner_homepage') }}">Dashboard</a>
    <a class="sidebar-btn" href="{{ url_for('index_views.owner_report') }}">Reports</a>
    <a class="sidebar-btn active" href="{{ url_for('index_views.owner_inventory') }}">Set Inventory</a>
    <a class="sidebar-btn" href="{{ url_for('index_views.owner_routes') }}">Routes</a>
    <a class="sidebar-btn sidebar-logout" href="{{ url_for('auth_views.logout') }}">Logout</a>
  </div>

  <!-- Main Content Area -->
  <div class="content-wrapper">
    <div class="header">Set Inventory</div>

    <div class="main-content">
      <div class="content-card">

        <!-- Tab Navigation -->
        <div class="tab-navigation">
          <button class="tab-btn active" id="inventory-tab" onclick="switchTab('inventory')">Daily Inventory</button>
          <button class="tab-btn" id="products-tab" onclick="switchTab('products')">Manage Products</button>
        </div>

        <!-- Daily Inventory Tab -->
        <div id="inventory-content" class="tab-content">
          <!-- View Mode -->
          <div id="view-mode">
            <div class="inventory-controls">
              <div class="filter-row">
                <div class="filter-group">
                  <label>View:</label>
                  <div class="custom-select-wrapper">
                    <div class="custom-select">
                      <div class="custom-select__trigger">
                        <span id="selected-view-text">Today's Inventory</span>
                        <div class="custom-select__arrow">▼</div>
                      </div>
                      <div class="custom-options">
                        <span class="custom-option selected" data-value="today">Today's Inventory</span>
                        <span class="custom-option" data-value="tomorrow">Tomorrow's Inventory</span>
                        <span class="custom-option" data-value="custom">Custom Date</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="filter-group" id="custom-date-group" style="display:none;">
                  <label>Date:</label>
                  <input type="date" id="custom-date" />
                </div>
              </div>

              <div style="display:flex; gap:10px;">
                <input type="file" id="csv-upload" accept=".csv" style="display:none;" />
                <button class="action-btn" id="import-csv-btn" onclick="document.getElementById('csv-upload').click()" style="display:none;">
                  Import CSV
                </button>
                <button class="action-btn edit-btn" id="edit-btn">
                  Edit <span id="edit-target">Tomorrow's</span> Inventory
                </button>
              </div>
            </div>

            <!-- Current Inventory Display (collapsible by category) -->
            <div class="inventory-display" id="inventory-display">
              <div style="text-align:center; padding:40px; color:#94a3b8;">
                Loading inventory...
              </div>
            </div>
          </div>

          <!-- Edit Mode -->
          <div id="edit-mode" style="display:none;">
            <div class="edit-header">
              <h2>Edit <span id="editing-date-label">Tomorrow's</span> Inventory</h2>
              <div class="edit-actions">
                <button class="action-btn cancel-btn" id="cancel-btn">Cancel</button>
                <button class="action-btn save-btn" id="save-btn">Save Inventory</button>
              </div>
            </div>

            <!-- Item Selection by Category (collapsible) -->
            <div id="catalog-by-category">
              <!-- Categories will be added here -->
            </div>

            <!-- Selected Items List -->
            <div class="selected-items-area">
              <h3>Selected Items for <span id="selected-date-label">Tomorrow</span></h3>
              <div class="selected-items-list" id="selected-items-list">
                <div style="text-align:center; padding:20px; color:#94a3b8;">
                  No items selected yet
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Manage Products Tab -->
        <div id="products-content" class="tab-content" style="display:none;">
          <div class="products-header">
            <h2>Product Catalog</h2>
            <button class="action-btn" id="add-product-btn">+ Add Product</button>
          </div>

          <div class="products-grid" id="products-grid">
            <div style="text-align:center; padding:40px; color:#94a3b8;">
              Loading products...
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Product Editor Modal -->
<div class="modal-overlay" id="product-modal" style="display:none;">
  <div class="modal-dialog">
    <div class="modal-header">
      <h3 id="product-modal-title">Add Product</h3>
      <button class="close-btn" onclick="hideProductModal()">✕</button>
    </div>
    <div class="modal-content">
      <div class="form-row-inline">
        <div class="form-group">
          <label>Product Name:</label>
          <input type="text" id="product-name" placeholder="e.g., Hops Bread" />
        </div>
        <div class="form-group">
          <label>Price ($):</label>
          <input type="number" id="product-price" step="0.01" min="0" placeholder="0.00" />
        </div>
      </div>
      <div class="form-group">
        <label>Category:</label>
        <input type="text" id="product-category" list="category-options" placeholder="e.g., Bread, Pastry, Doubles" />
        <datalist id="category-options">
          <!-- Dynamically populated categories -->
        </datalist>
      </div>
      <div class="form-group">
        <label>Description (optional):</label>
        <textarea id="product-description" rows="2" placeholder="Brief description"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="action-btn cancel-btn" onclick="hideProductModal()">Cancel</button>
      <button class="action-btn save-btn" id="save-product-btn">Save Product</button>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/owner/set_inventory.js') }}"></script>
{% endblock %}